#
# Bash completion for TimeWarrior
#
# Copyright (C) 2017  Thomas Lauf
#
function __get_options()
{
  echo "--help --verbose --version"
}

function _timew()
{
  local cur prev commands options
  COMPREPLY=()
  cur="${COMP_WORDS[COMP_CWORD]}"
  prev="${COMP_WORDS[COMP_CWORD-1]}"
  first="${COMP_WORDS[1]}"
  commands="cancel config continue day delete diagnostics export extensions gaps get help join lengthen month move report shorten show split start stop summary tag tags track untag week"
  #
  #  Complete the arguments to some of the basic commands.
  #
  case "${first}" in
    continue|tag|untag)
      if [ "${cur}" = "@" ] ; then
        local ids="@1 @2 @3 @4 @5 @6 @7 @8 @9"
        COMPREPLY=( $(compgen -W "${ids}" -- "${cur}") )
        return 0
      else
        case "${prev}" in
          @*)
            local tags
            tags=$(timew tags | awk '{if(NR>3)print $1}')
            COMPREPLY=( $(compgen -W "${tags}" -- "${cur}") )
            return 0
            ;;
          *)
            local ids="@1 @2 @3 @4 @5 @6 @7 @8 @9"
            COMPREPLY=( $(compgen -W "${ids}" -- "${cur}") )
            return 0
            ;;
        esac
      fi
      ;;
    --*)
      wordlist=$( __get_options )
      ;;
    *)
      COMPREPLY=( $(compgen -W "${commands}" -- "${cur}") )
      return 0
      ;;
  esac

 COMPREPLY=($(compgen -W "${wordlist}" -- "${cur}"))
}

complete -F _timew timew
